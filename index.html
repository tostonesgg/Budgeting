<script defer src="app.js?v=share-freq-local-1"></script>
<script>
  window.addEventListener('DOMContentLoaded', function(){
    try { if (window.lucide?.createIcons) window.lucide.createIcons(); } catch(e){}

    // Initialize swatch color in Add Category
    const addColorInput = document.getElementById('cat-color');
    const addColorSwatch = document.querySelector('#cat-color-btn .swatch');
    if (addColorInput && addColorSwatch) {
      const setSwatch = () => addColorSwatch.style.background = addColorInput.value;
      setSwatch();
      addColorInput.addEventListener('input', setSwatch);
      addColorInput.addEventListener('change', setSwatch);
    }

    // Sticky income card logic
    const incomeCard = document.getElementById('income-card');
    const sticky = document.getElementById('income-sticky');
    const stickyMonthly = document.getElementById('sticky-monthly');
    const stickyYearly = document.getElementById('sticky-yearly');
    const stickyPlay = document.getElementById('sticky-play');

    const incomeInput = document.getElementById('net-income');
    const yearlyText = document.getElementById('net-yearly');
    const playLeft = document.getElementById('play-left');

    function updateSticky() {
      stickyMonthly.textContent = incomeInput.value || '—';
      stickyYearly.textContent = yearlyText.textContent.replace('Yearly:', '').trim() || '—';
      stickyPlay.textContent = playLeft.dataset.value || '—';  // use clean data attribute
    }

    window.addEventListener('scroll', () => {
      const rect = incomeCard.getBoundingClientRect();
      if (rect.bottom <= 0) {
        sticky.classList.remove('hidden');
      } else {
        sticky.classList.add('hidden');
      }
    });

    incomeInput.addEventListener('input', updateSticky);
    new MutationObserver(updateSticky).observe(yearlyText, {childList:true});
    new MutationObserver(updateSticky).observe(playLeft, {attributes:true, attributeFilter:['data-value']});
    updateSticky();
  });
</script>
